import React, { useContext, useEffect } from 'react';
import { Pane, Spinner, BackButton } from 'evergreen-ui';

import GithubContext from 'context/Github/GithubContext';
import User from 'components/User';
import Repository from 'components/Repository';

import './profile.scss';

function Profile({ match }) {

    const { getUser, getRepositories, isLoading, user, repositories } = useContext(GithubContext);
    const { username } = match.params;

    useEffect(() => {
        getUser(username);
        getRepositories(username);
        // eslint-disable-next-line react-hooks/exhaustive-deps
    }, []);

    if (isLoading) {
        return (
            <Pane display="flex" alignItems="center" justifyContent="center" height={400}>
                <Spinner />
            </Pane>
        );
    }

    return (
        <div className="profile">
            <div
                style={{ paddingTop: '32px', paddingBottom: '32px' }}
            >
                <BackButton>
                    Back
                </BackButton>
            </div>
            <User user={user} />
            <div className="repositories-list">
                <ul>
                    {repositories.length > 0 && repositories.map((repository) => (
                        <li key={repository.id}>
                            <Repository {...repository} />
                        </li>
                    ))}
                </ul>
            </div>
        </div>
    );
}

export default Profile;