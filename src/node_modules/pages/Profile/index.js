import React, { Fragment, useContext, useEffect } from 'react';
import { useHistory } from "react-router-dom";
import { Pane, Spinner, BackButton } from 'evergreen-ui';

import GithubContext from 'context/Github/GithubContext';
import User from 'components/User';
import Repository from 'components/Repository';

import './profile.scss';

function Profile({ match }) {

    const { getUser, getRepositories, isLoading, user, repositories } = useContext(GithubContext);
    const { username } = match.params;
    const history = useHistory();

    useEffect(() => {
        getUser(username);
        getRepositories(username);
        // eslint-disable-next-line react-hooks/exhaustive-deps
    }, []);

    if (isLoading) {
        return (
            <Pane display="flex" alignItems="center" justifyContent="center" height={400}>
                <Spinner />
            </Pane>
        );
    }

    return (
        <Fragment>
            <div
                style={{ paddingTop: '32px', paddingBottom: '32px' }}
            >
                <BackButton
                    onClick={() => history.goBack()}
                >
                    Back
                </BackButton>
            </div>

            <div className="profile">
                <User {...user} />
                <div className="repositories-list">
                    {repositories.length > 0 && repositories.map((repository) => (
                        <Repository key={repository.id} {...repository} />
                    ))}
                </div>
            </div>

            <div style={{ height: '60px' }}></div>
        </Fragment>
    );
}

export default Profile;